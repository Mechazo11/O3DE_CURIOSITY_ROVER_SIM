# ROS2 Gem, O3DE

This markdown file is desinged to keep notes on how to use ROS 2 Gem in O3DE

## How ROS 2 publisher/subscribers are generated by the prefab model?

* What happens when I just hit **play** on the vanilla simulation?

From Dr. Hanca

* You do not need any extra files, it is already there in O3DE. You only need to add certain ROS 2 components to your entity to make it working. The components will trigger subscribers/publishers when game mode is activated. You might change all parameters such as topic name or QoS within the component itself.

<p align="left">
<img src="image-2.png" alt="alt text" style="height:200;">
</p>

* This is the line you were looking for. This line in the prefab opens **ROS2RobotControlComponent** which implements the subscriber. I am not sure what you want to achieve. E.g, if you want to get two robots moving on the scene, you should add a second prefab and change the topic (using prefab overrides) of one of the robots. This can be found in the inspector of the entity.


# Post Processing Curiosity model for work

Use the interactive GUI to add components for the following image

* ```base_link``` part must have the following O3DE components (part of ROS 2 Gem)

  * Skid Steering Vehicle Model was setup with the following key components
  * ROS2 Frame
  * ROS2 Robot Control
  * Skid Steering Twist Control

* Each ```wheel_link``` needs to have the following ROS2 components
  * PhysX Dynamic Rigid Body
  * Wheel Controller: Just set it to default
  * [ROS 2 Vehicle Dynamics](https://www.docs.o3de.org/docs/user-guide/interactivity/robotics/vehicle-dynamics/) implements the ```Skid Steering Vehicle Model```.

* To counteract force of gravity, Articulation link for ```suspension_arm_F_L```,```suspension_arm_B_L```, ```suspension_arm_F_R```, ```suspension_arm_B_R```, ```TODO```, ```TODO```, ```TODO``` that supports the weight of the body, needs to have ```motors``` activated with the following values
  * Force Limit Value: 100000.0
  * Stiffness Value: 50000.0
  * Damping Value: 50000.0
  * Force limits,stiffness and damping for hinge joints: 10000.0

According to Dr. Hanca

```text
Motor in this context is a device that can apply forces. E.g. it can produce the force that  is opposite to the gravity to keep the device in balance or it can be asked to change the position of the joint by applying even more forces (e.g. to start rotating the wheel and counteract the damping).
```

* Done similar for sensor_mast and arm hinges

# Creating Physics Material for Rover wheel

Use this tutorial to create one https://docs.o3de.org/docs/user-guide/interactivity/physics/nvidia-physx/materials/

From gazebo file

# How O3DE and ROS 2 Gem communicates with ROS 2?

* ROS 2 gem starts by adding a ROS 2 node in the **ROS 2 graph**. This is done through ```ROS2SystemComponent``` a centralized, **singleton** i.e. only one node instance that connects with the ROS 2 graph.

An example of creating a subscriber to send data to the **ROS 2 Graph**

```c++
auto ros2Node = ROS2Interface::Get()->GetNode();
AZStd::string fullTopic = ROS2Names::GetNamespacedName(GetNamespace(), m_MyTopic);
m_myPublisher = ros2Node->create_publisher<sensor_msgs::msg::PointCloud2>(fullTopic.data(), QoS());
```

But we only modify it if we need to add lidar/camera or other special features. 